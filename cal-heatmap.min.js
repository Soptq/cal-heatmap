onload=function(){
/*! cal-heatmap v3.6.2 (Wed Aug 22 2018 16:34:12)
 *  ---------------------------------------------
 *  Cal-Heatmap is a javascript module to create calendar heatmap to visualize time series data
 *  https://github.com/wa0x6e/cal-heatmap
 *  Licensed under the MIT license
 *  Copyright 2014 Wan Qi Chen
 */
var t="function"==typeof require?require("d3"):window.d3,e=function(){"use strict";var e=this;for(var o in this.allowedDataType=["json","csv","tsv","txt"],this.options={itemSelector:"#cal-heatmap",paintOnLoad:!0,range:12,cellSize:10,cellPadding:2,cellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],domain:"hour",subDomain:"min",colLimit:null,rowLimit:null,weekStartOnMonday:!0,start:new Date,minDate:null,maxDate:null,data:"",dataType:this.allowedDataType[0],dataPostPayload:null,dataRequestHeaders:null,considerMissingDataAsZero:!1,loadOnInit:!0,verticalOrientation:!1,domainDynamicDimension:!0,label:{position:"bottom",align:"center",offset:{x:0,y:0},rotate:null,width:100,height:null},legend:[10,20,30,40],displayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],legendVerticalPosition:"bottom",legendHorizontalPosition:"left",legendOrientation:"horizontal",legendColors:null,highlight:[],itemName:["item","items"],domainLabelFormat:null,subDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},subDomainDateFormat:null,subDomainTextFormat:null,legendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},animationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,onClick:null,afterLoad:null,afterLoadNextDomain:null,afterLoadPreviousDomain:null,onComplete:null,afterLoadData:function(t){return t},afterUpdate:null,onMaxDomainReached:null,onMinDomainReached:null},this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){return Math.floor(t.getMinutes()/e._domainType.min.row(t))},y:function(t){return t.getMinutes()%e._domainType.min.row(t)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function(t){switch(e.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(e.options.domainDynamicDimension?e.getDayCountInMonth(t):31)}},defaultRowNumber:6,defaultColumnNumber:function(t){switch(e.options.domain){case"day":return 4;case"week":return 28;case"month":return e.options.domainDynamicDimension?e.getDayCountInMonth(t):31}},row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){return"month"===e.options.domain?e.options.colLimit>0||e.options.rowLimit>0?Math.floor((t.getHours()+24*(t.getDate()-1))/e._domainType.hour.row(t)):Math.floor(t.getHours()/e._domainType.hour.row(t))+4*(t.getDate()-1):"week"===e.options.domain?e.options.colLimit>0||e.options.rowLimit>0?Math.floor((t.getHours()+24*e.getWeekDay(t))/e._domainType.hour.row(t)):Math.floor(t.getHours()/e._domainType.hour.row(t))+4*e.getWeekDay(t):Math.floor(t.getHours()/e._domainType.hour.row(t))},y:function(t){var n=t.getHours();if(e.options.colLimit>0||e.options.rowLimit>0)switch(e.options.domain){case"month":n+=24*(t.getDate()-1);break;case"week":n+=24*e.getWeekDay(t)}return Math.floor(n%e._domainType.hour.row(t))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber:function(t){switch(e.options.domain){case"week":return 7;case"month":return e.options.domainDynamicDimension?e.getDayCountInMonth(t):31;case"year":return e.options.domainDynamicDimension?e.getDayCountInYear(t):366}},defaultColumnNumber:function(t){switch(t=new Date(t),e.options.domain){case"week":return 1;case"month":return e.options.domainDynamicDimension&&!e.options.verticalOrientation?e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-e.getWeekNumber(t)+1:6;case"year":return e.options.domainDynamicDimension?e.getWeekNumber(new Date(t.getFullYear(),11,31))-e.getWeekNumber(new Date(t.getFullYear(),0))+1:54}},defaultRowNumber:7,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){switch(e.options.domain){case"week":return Math.floor(e.getWeekDay(t)/e._domainType.day.row(t));case"month":return e.options.colLimit>0||e.options.rowLimit>0?Math.floor((t.getDate()-1)/e._domainType.day.row(t)):e.getWeekNumber(t)-e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));case"year":return e.options.colLimit>0||e.options.rowLimit>0?Math.floor((e.getDayOfYear(t)-1)/e._domainType.day.row(t)):e.getWeekNumber(t)}},y:function(t){var n=e.getWeekDay(t);if(e.options.colLimit>0||e.options.rowLimit>0)switch(e.options.domain){case"year":n=e.getDayOfYear(t)-1;break;case"week":n=e.getWeekDay(t);break;case"month":n=t.getDate()-1}return Math.floor(n%e._domainType.day.row(t))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function(t){switch(t=new Date(t),e.options.domain){case"year":return e._domainType.week.maxItemNumber;case"month":return e.options.domainDynamicDimension?e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-e.getWeekNumber(t):5}},defaultRowNumber:1,row:function(t){return e.getSubDomainRowNumber(t)},column:function(t){return e.getSubDomainColumnNumber(t)},position:{x:function(t){switch(e.options.domain){case"year":return Math.floor(e.getWeekNumber(t)/e._domainType.week.row(t));case"month":return Math.floor(e.getMonthWeekNumber(t)/e._domainType.week.row(t))}},y:function(t){return e.getWeekNumber(t)%e._domainType.week.row(t)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function(t){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=n.getDay()-(e.options.weekStartOnMonday?1:0);return i<0&&(i=6),n.setDate(n.getDate()-i),n.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function(){return e.getSubDomainRowNumber()},column:function(){return e.getSubDomainColumnNumber()},position:{x:function(t){return Math.floor(t.getMonth()/e._domainType.month.row(t))},y:function(t){return t.getMonth()%e._domainType.month.row(t)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function(t){return new Date(t.getFullYear(),t.getMonth()).getTime()}},year:{name:"year",level:60,row:function(){return e.options.rowLimit||1},column:function(){return e.options.colLimit||1},position:{x:function(){return 1},y:function(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function(t){return new Date(t.getFullYear()).getTime()}}},this._domainType)if(this._domainType.hasOwnProperty(o)){var a=this._domainType[o];this._domainType["x_"+o]={name:"x_"+o,level:a.type,maxItemNumber:a.maxItemNumber,defaultRowNumber:a.defaultRowNumber,defaultColumnNumber:a.defaultColumnNumber,row:a.column,column:a.row,position:{x:a.position.y,y:a.position.x},format:a.format,extractUnit:a.extractUnit}}function r(t,n){var i=e.options.cellSize*e._domainType[e.options.subDomain].column(t)+e.options.cellPadding*e._domainType[e.options.subDomain].column(t);return 2===arguments.length&&!0===n?i+(e.domainHorizontalLabelWidth+e.options.domainGutter+e.options.domainMargin[1]+e.options.domainMargin[3]):i}function s(t,n){var i=e.options.cellSize*e._domainType[e.options.subDomain].row(t)+e.options.cellPadding*e._domainType[e.options.subDomain].row(t);return 2===arguments.length&&!0===n&&(i+=e.options.domainGutter+e.domainVerticalLabelHeight+e.options.domainMargin[0]+e.options.domainMargin[2]),i}this.lastInsertedSvg=null,this._completed=!1,this._domains=t.map(),this.graphDim={width:0,height:0},this.legendDim={width:0,height:0},this.NAVIGATE_LEFT=1,this.NAVIGATE_RIGHT=2,this.RESET_ALL_ON_UPDATE=0,this.RESET_SINGLE_ON_UPDATE=1,this.APPEND_ON_UPDATE=2,this.DEFAULT_LEGEND_MARGIN=10,this.root=null,this.tooltip=null,this._maxDomainReached=!1,this._minDomainReached=!1,this.domainPosition=new n,this.Legend=null,this.legendScale=null,this.DSTDomain=[],this._init=function(){return e.getDomain(e.options.start).map((function(t){return t.getTime()})).map((function(t){e._domains.set(t,e.getSubDomain(t).map((function(t){return{t:e._domainType[e.options.subDomain].extractUnit(t),v:null}})))})),e.root=t.select(e.options.itemSelector).append("svg").attr("class","cal-heatmap-container"),e.tooltip=t.select(e.options.itemSelector).attr("style",(function(){var n=t.select(e.options.itemSelector).attr("style");return(null!==n?n:"")+"position:relative;"})).append("div").attr("class","ch-tooltip"),e.root.attr("x",0).attr("y",0).append("svg").attr("class","graph"),e.Legend=new i(e),e.options.paintOnLoad&&function(){e.verticalDomainLabel="top"===e.options.label.position||"bottom"===e.options.label.position,e.domainVerticalLabelHeight=null===e.options.label.height?Math.max(25,2*e.options.cellSize):e.options.label.height,e.domainHorizontalLabelWidth=0,""===e.options.domainLabelFormat&&null===e.options.label.height&&(e.domainVerticalLabelHeight=0),e.verticalDomainLabel||(e.domainVerticalLabelHeight=0,e.domainHorizontalLabelWidth=e.options.label.width),e.paint(),!1!==e.options.nextSelector&&t.select(e.options.nextSelector).on("click."+e.options.itemNamespace,(function(){return t.event.preventDefault(),e.loadNextDomain(1)})),!1!==e.options.previousSelector&&t.select(e.options.previousSelector).on("click."+e.options.itemNamespace,(function(){return t.event.preventDefault(),e.loadPreviousDomain(1)})),e.Legend.redraw(e.graphDim.width-e.options.domainGutter-e.options.cellPadding),e.afterLoad();var n=e.getDomainKeys();e.options.loadOnInit?e.getDatas(e.options.data,new Date(n[0]),e.getSubDomain(n[n.length-1]).pop(),(function(){e.fill(),e.onComplete()})):e.onComplete(),e.checkIfMinDomainIsReached(n[0]),e.checkIfMaxDomainIsReached(e.getNextDomain().getTime())}(),!0},this.paint=function(t){var n=e.options;0===arguments.length&&(t=!1);var i=e.root.select(".graph").selectAll(".graph-domain").data((function(){var n=e.getDomainKeys();return t===e.NAVIGATE_LEFT?n.reverse():n}),(function(t){return t})),o=0,a=0,l=i.enter().append("svg").attr("width",(function(t){return r(t,!0)})).attr("height",(function(t){return s(t,!0)})).attr("x",(function(t){return n.verticalOrientation?(e.graphDim.width=Math.max(e.graphDim.width,r(t,!0)),0):u(t,e.graphDim,"width",r(t,!0))})).attr("y",(function(t){return n.verticalOrientation?u(t,e.graphDim,"height",s(t,!0)):(e.graphDim.height=Math.max(e.graphDim.height,s(t,!0)),0)})).attr("class",(function(t){var i="graph-domain",o=new Date(t);switch(n.domain){case"hour":i+=" h_"+o.getHours();case"day":i+=" d_"+o.getDate()+" dy_"+o.getDay();case"week":i+=" w_"+e.getWeekNumber(o);case"month":i+=" m_"+(o.getMonth()+1);case"year":i+=" y_"+o.getFullYear()}return i}));function u(n,i,r,s){var l=0;switch(t){case!1:return l=i[r],i[r]+=s,e.domainPosition.setPosition(n,l),l;case e.NAVIGATE_RIGHT:return e.domainPosition.setPosition(n,i[r]),o=s,a=e.domainPosition.getPositionFromIndex(1),e.domainPosition.shiftRightBy(a),i[r];case e.NAVIGATE_LEFT:return o=-(l=-s),a=i[r]-e.domainPosition.getLast(),e.domainPosition.setPosition(n,l),e.domainPosition.shiftLeftBy(o),l}}e.lastInsertedSvg=l,l.append("rect").attr("width",(function(t){return r(t,!0)-n.domainGutter-n.cellPadding})).attr("height",(function(t){return s(t,!0)-n.domainGutter-n.cellPadding})).attr("class","domain-background");var c=l.append("svg").attr("x",(function(){return"left"===n.label.position?e.domainHorizontalLabelWidth+n.domainMargin[3]:n.domainMargin[3]})).attr("y",(function(){return"top"===n.label.position?e.domainVerticalLabelHeight+n.domainMargin[0]:n.domainMargin[0]})).attr("class","graph-subdomain-group"),m=c.selectAll("g").data((function(t){return e._domains.get(t)})).enter().append("g");function h(t){switch(n.label.rotate){case"right":t.attr("transform",(function(t){var i="rotate(90), ";switch(n.label.position){case"right":i+="translate(-"+r(t)+" , -"+r(t)+")";break;case"left":i+="translate(0, -"+e.domainHorizontalLabelWidth+")"}return i}));break;case"left":t.attr("transform",(function(t){var i="rotate(270), ";switch(n.label.position){case"right":i+="translate(-"+(r(t)+e.domainHorizontalLabelWidth)+" , "+r(t)+")";break;case"left":i+="translate(-"+e.domainHorizontalLabelWidth+" , "+e.domainHorizontalLabelWidth+")"}return i}))}}m.append("rect").attr("class",(function(t){return"graph-rect"+e.getHighlightClassName(t.t)+(null!==n.onClick?" hover_cursor":"")})).attr("width",n.cellSize).attr("height",n.cellSize).attr("x",(function(t){return e.positionSubDomainX(t.t)})).attr("y",(function(t){return e.positionSubDomainY(t.t)})).on("click",(function(t){if(null!==n.onClick)return e.onClick(new Date(t.t),t.v)})).call((function(t){n.cellRadius>0&&t.attr("rx",n.cellRadius).attr("ry",n.cellRadius),null!==e.legendScale&&null!==n.legendColors&&n.legendColors.hasOwnProperty("base")&&t.attr("fill",n.legendColors.base),n.tooltip&&(t.on("mouseover",(function(t){var i=this.parentNode.parentNode;e.tooltip.html(e.getSubDomainTitle(t)).attr("style","display: block;");var o=e.positionSubDomainX(t.t)-e.tooltip.node().offsetWidth/2+n.cellSize/2,a=e.positionSubDomainY(t.t)-e.tooltip.node().offsetHeight-n.cellSize/2;o+=parseInt(i.getAttribute("x"),10),a+=parseInt(i.getAttribute("y"),10),o+=parseInt(e.root.select(".graph").attr("x"),10),a+=parseInt(e.root.select(".graph").attr("y"),10),o+=parseInt(i.parentNode.getAttribute("x"),10),a+=parseInt(i.parentNode.getAttribute("y"),10),e.tooltip.attr("style","display: block; left: "+o+"px; top: "+a+"px;")})),t.on("mouseout",(function(){e.tooltip.attr("style","display:none").html("")})))})),n.tooltip||m.append("title").text((function(t){return e.formatDate(new Date(t.t),n.subDomainDateFormat)})),""!==n.domainLabelFormat&&l.append("text").attr("class","graph-label").attr("y",(function(t){var i=n.domainMargin[0];switch(n.label.position){case"top":i+=e.domainVerticalLabelHeight/2;break;case"bottom":i+=s(t)+e.domainVerticalLabelHeight/2}return i+n.label.offset.y*("right"===n.label.rotate&&"right"===n.label.position||"left"===n.label.rotate&&"left"===n.label.position?-1:1)})).attr("x",(function(t){var i=n.domainMargin[3];switch(n.label.position){case"right":i+=r(t);break;case"bottom":case"top":i+=r(t)/2}return"right"===n.label.align?i+e.domainHorizontalLabelWidth-n.label.offset.x*("right"===n.label.rotate?-1:1):i+n.label.offset.x})).attr("text-anchor",(function(){switch(n.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle"}})).attr("dominant-baseline",(function(){return e.verticalDomainLabel?"middle":"top"})).text((function(t){return e.formatDate(new Date(t),n.domainLabelFormat)})).call(h),null!==n.subDomainTextFormat&&m.append("text").attr("class",(function(t){return"subdomain-text"+e.getHighlightClassName(t.t)})).attr("x",(function(t){return e.positionSubDomainX(t.t)+n.cellSize/2})).attr("y",(function(t){return e.positionSubDomainY(t.t)+n.cellSize/2})).attr("text-anchor","middle").attr("dominant-baseline","central").text((function(t){return e.formatDate(new Date(t.t),n.subDomainTextFormat)})),!1!==t&&i.transition().duration(n.animationDuration).attr("x",(function(t){return n.verticalOrientation?0:e.domainPosition.getPosition(t)})).attr("y",(function(t){return n.verticalOrientation?e.domainPosition.getPosition(t):0}));var g=e.graphDim.width,d=e.graphDim.height;n.verticalOrientation?e.graphDim.height+=o-a:e.graphDim.width+=o-a,i.exit().transition().duration(n.animationDuration).attr("x",(function(i){if(n.verticalOrientation)return 0;switch(t){case e.NAVIGATE_LEFT:return Math.min(e.graphDim.width,g);case e.NAVIGATE_RIGHT:return-r(i,!0)}})).attr("y",(function(i){if(!n.verticalOrientation)return 0;switch(t){case e.NAVIGATE_LEFT:return Math.min(e.graphDim.height,d);case e.NAVIGATE_RIGHT:return-s(i,!0)}})).remove(),e.resize()}};e.prototype={init:function(e){"use strict";var n=this,i=n.options=function t(e,n){for(var i in n)try{e[i]=n[i].constructor===Object?t(e[i],n[i]):n[i]}catch(t){e[i]=n[i]}return e}(n.options,e);if(function(){if(!n._domainType.hasOwnProperty(i.domain)||"min"===i.domain||"x_"===i.domain.substring(0,2))throw Error("The domain '"+i.domain+"' is not valid");if(!n._domainType.hasOwnProperty(i.subDomain)||"year"===i.subDomain)throw Error("The subDomain '"+i.subDomain+"' is not valid");if(n._domainType[i.domain].level<=n._domainType[i.subDomain].level)throw Error("'"+i.subDomain+"' is not a valid subDomain to '"+i.domain+"'")}(),s(i.itemSelector,!1,"itemSelector"),-1===n.allowedDataType.indexOf(i.dataType))throw Error("The data type '"+i.dataType+"' is not valid data type");if(t.select(i.itemSelector).empty())throw Error("The node '"+i.itemSelector+"' specified in itemSelector does not exists");try{s(i.nextSelector,!0,"nextSelector"),s(i.previousSelector,!0,"previousSelector")}catch(t){return console.log(t.message),!1}e.hasOwnProperty("subDomain")||(this.options.subDomain=function(t){switch(t){case"year":return"month";case"month":case"week":return"day";case"day":return"hour";default:return"min"}}(e.domain)),"string"==typeof i.itemNamespace&&""!==i.itemNamespace||(console.log("itemNamespace can not be empty, falling back to cal-heatmap"),i.itemNamespace="cal-heatmap");var o,a=["data","onComplete","onClick","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain","afterUpdate"];for(var r in a)e.hasOwnProperty(a[r])&&(i[a[r]]=e[a[r]]);function s(t,e,n){if((e&&!1===t||t instanceof Element||"string"==typeof t)&&""!==t)return!0;throw Error("The "+n+" is not valid")}function l(t){switch("number"==typeof t&&(t=[t]),Array.isArray(t)||(console.log("Margin only takes an integer or an array of integers"),t=[0]),t.length){case 1:return[t[0],t[0],t[0],t[0]];case 2:return[t[0],t[1],t[0],t[1]];case 3:return[t[0],t[1],t[2],t[1]];case 4:return t;default:return t.slice(0,4)}}return i.subDomainDateFormat="string"==typeof i.subDomainDateFormat||"function"==typeof i.subDomainDateFormat?i.subDomainDateFormat:this._domainType[i.subDomain].format.date,i.domainLabelFormat="string"==typeof i.domainLabelFormat||"function"==typeof i.domainLabelFormat?i.domainLabelFormat:this._domainType[i.domain].format.legend,i.subDomainTextFormat="string"==typeof i.subDomainTextFormat&&""!==i.subDomainTextFormat||"function"==typeof i.subDomainTextFormat?i.subDomainTextFormat:null,i.domainMargin=l(i.domainMargin),i.legendMargin=l(i.legendMargin),i.highlight=n.expandDateSetting(i.highlight),i.itemName=function(t){return"string"==typeof t?[t,t+(""!==t?"s":"")]:Array.isArray(t)?1===t.length?[t[0],t[0]+"s"]:t.length>2?t.slice(0,2):t:["item","items"]}(i.itemName),i.colLimit=(o=i.colLimit)>0?o:null,i.rowLimit=function(t){return t>0&&i.colLimit>0?(console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored"),null):t>0?t:null}(i.rowLimit),e.hasOwnProperty("legendMargin")||function(){switch(i.legendVerticalPosition){case"top":i.legendMargin[2]=n.DEFAULT_LEGEND_MARGIN;break;case"bottom":i.legendMargin[0]=n.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":i.legendMargin["right"===i.legendHorizontalPosition?3:1]=n.DEFAULT_LEGEND_MARGIN}}(),function(){if(!e.hasOwnProperty("label")||e.hasOwnProperty("label")&&!e.label.hasOwnProperty("align")){switch(i.label.position){case"left":i.label.align="right";break;case"right":i.label.align="left";break;default:i.label.align="center"}"left"===i.label.rotate?i.label.align="right":"right"===i.label.rotate&&(i.label.align="left")}(!e.hasOwnProperty("label")||e.hasOwnProperty("label")&&!e.label.hasOwnProperty("offset"))&&("left"!==i.label.position&&"right"!==i.label.position||(i.label.offset={x:10,y:15}))}(),this._init()},expandDateSetting:function(t){"use strict";return Array.isArray(t)||(t=[t]),t.map((function(t){return"now"===t?new Date:t instanceof Date&&t})).filter((function(t){return!1!==t}))},fill:function(t){"use strict";var e=this,n=e.options;0===arguments.length&&(t=e.root.selectAll(".graph-domain"));var i=t.selectAll("svg").selectAll("g").data((function(t){return e._domains.get(t)}));function o(t){if(null===e.legendScale)return!1;t.attr("fill",(function(t){return null===t.v&&n.hasOwnProperty("considerMissingDataAsZero")&&!n.considerMissingDataAsZero&&n.legendColors.hasOwnProperty("base")?n.legendColors.base:null!==n.legendColors&&n.legendColors.hasOwnProperty("empty")&&(0===t.v||null===t.v&&n.hasOwnProperty("considerMissingDataAsZero")&&n.considerMissingDataAsZero)?n.legendColors.empty:t.v<0&&n.legend[0]>0&&null!==n.legendColors&&n.legendColors.hasOwnProperty("overflow")?n.legendColors.overflow:e.legendScale(Math.min(t.v,n.legend[n.legend.length-1]))}))}function a(t){"function"==typeof n.subDomainTextFormat&&t.text((function(t){return n.subDomainTextFormat(t.t,t.v)}))}i.transition().duration(n.animationDuration).select("rect").attr("class",(function(t){var i=e.getHighlightClassName(t.t).trim().split(" "),o=e.dateIsLessThan(t.t,new Date),a=e.dateIsEqual(t.t,new Date);return(null===e.legendScale||null===t.v&&n.hasOwnProperty("considerMissingDataAsZero")&&!n.considerMissingDataAsZero&&!n.legendColors.hasOwnProperty("base"))&&i.push("graph-rect"),a?i.push("now"):o||i.push("future"),null!==t.v?i.push(e.Legend.getClass(t.v,null===e.legendScale)):n.considerMissingDataAsZero&&o&&i.push(e.Legend.getClass(0,null===e.legendScale)),null!==n.onClick&&i.push("hover_cursor"),i.join(" ")})).call(o),i.transition().duration(n.animationDuration).select("title").text((function(t){return e.getSubDomainTitle(t)})),i.transition().duration(n.animationDuration).select("text").attr("class",(function(t){return"subdomain-text"+e.getHighlightClassName(t.t)})).call(a)},formatStringWithObject:function(t,e){"use strict";for(var n in e)if(e.hasOwnProperty(n)){var i=RegExp("\\{"+n+"\\}","gi");t=t.replace(i,e[n])}return t},triggerEvent:function(t,e,n){"use strict";return!!(3===arguments.length&&n||null===this.options[t])||("function"==typeof this.options[t]?("function"==typeof e&&(e=e()),this.options[t].apply(this,e)):(console.log("Provided callback for "+t+" is not a function."),!1))},onClick:function(t,e){"use strict";return this.triggerEvent("onClick",[t,e])},afterLoad:function(){"use strict";return this.triggerEvent("afterLoad")},onComplete:function(){"use strict";var t=this.triggerEvent("onComplete",[],this._completed);return this._completed=!0,t},afterLoadPreviousDomain:function(t){"use strict";var e=this;return this.triggerEvent("afterLoadPreviousDomain",(function(){var n=e.getSubDomain(t);return[n.shift(),n.pop()]}))},afterLoadNextDomain:function(t){"use strict";var e=this;return this.triggerEvent("afterLoadNextDomain",(function(){var n=e.getSubDomain(t);return[n.shift(),n.pop()]}))},onMinDomainReached:function(t){"use strict";return this._minDomainReached=t,this.triggerEvent("onMinDomainReached",[t])},onMaxDomainReached:function(t){"use strict";return this._maxDomainReached=t,this.triggerEvent("onMaxDomainReached",[t])},checkIfMinDomainIsReached:function(t,e){"use strict";this.minDomainIsReached(t)&&this.onMinDomainReached(!0),2===arguments.length&&this._maxDomainReached&&!this.maxDomainIsReached(e)&&this.onMaxDomainReached(!1)},checkIfMaxDomainIsReached:function(t,e){"use strict";this.maxDomainIsReached(t)&&this.onMaxDomainReached(!0),2===arguments.length&&this._minDomainReached&&!this.minDomainIsReached(e)&&this.onMinDomainReached(!1)},afterUpdate:function(){"use strict";return this.triggerEvent("afterUpdate")},formatNumber:t.format(",g"),formatDate:function(e,n){"use strict";if(arguments.length<2&&(n="title"),"function"==typeof n)return n(e);var i=t.timeFormat(n);return i(e)},getSubDomainTitle:function(t){"use strict";if(null!==t.v||this.options.considerMissingDataAsZero){var e=t.v;return null===e&&this.options.considerMissingDataAsZero&&(e=0),this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(e),name:this.options.itemName[1!==e?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(t.t),this.options.subDomainDateFormat)})}return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(t.t),this.options.subDomainDateFormat)})},loadNextDomain:function(t){"use strict";if(this._maxDomainReached||0===t)return!1;var e=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),t));return this.afterLoadNextDomain(e.end),this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),e.start),!0},loadPreviousDomain:function(t){"use strict";if(this._minDomainReached||0===t)return!1;var e=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-t).reverse());return this.afterLoadPreviousDomain(e.start),this.checkIfMinDomainIsReached(e.start,e.end),!0},loadNewDomains:function(t,e){"use strict";var n=this,i=t===this.NAVIGATE_LEFT,o=-1,a=e.length,r=this.getDomainKeys();function s(t){return{t:n._domainType[n.options.subDomain].extractUnit(t),v:null}}for(;++o<a;){if(i&&this.minDomainIsReached(e[o])){e=e.slice(0,o+1);break}if(!i&&this.maxDomainIsReached(e[o])){e=e.slice(0,o);break}}for(o=0,a=(e=e.slice(-this.options.range)).length;o<a;o++)this._domains.set(e[o].getTime(),this.getSubDomain(e[o]).map(s)),this._domains.remove(i?r.pop():r.shift());return r=this.getDomainKeys(),i&&(e=e.reverse()),this.paint(t),this.getDatas(this.options.data,e[0],this.getSubDomain(e[e.length-1]).pop(),(function(){n.fill(n.lastInsertedSvg)})),{start:e[i?0:1],end:r[r.length-1]}},maxDomainIsReached:function(t){"use strict";return null!==this.options.maxDate&&this.options.maxDate.getTime()<t},minDomainIsReached:function(t){"use strict";return null!==this.options.minDate&&this.options.minDate.getTime()>=t},getDomainKeys:function(){"use strict";return this._domains.keys().map((function(t){return parseInt(t,10)})).sort((function(t,e){return t-e}))},positionSubDomainX:function(t){"use strict";var e=this._domainType[this.options.subDomain].position.x(new Date(t));return e*this.options.cellSize+e*this.options.cellPadding},positionSubDomainY:function(t){"use strict";var e=this._domainType[this.options.subDomain].position.y(new Date(t));return e*this.options.cellSize+e*this.options.cellPadding},getSubDomainColumnNumber:function(t){"use strict";if(this.options.rowLimit>0){var e=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof e&&(e=e(t)),Math.ceil(e/this.options.rowLimit)}var n=this._domainType[this.options.subDomain].defaultColumnNumber;return"function"==typeof n&&(n=n(t)),this.options.colLimit||n},getSubDomainRowNumber:function(t){"use strict";if(this.options.colLimit>0){var e=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof e&&(e=e(t)),Math.ceil(e/this.options.colLimit)}var n=this._domainType[this.options.subDomain].defaultRowNumber;return"function"==typeof n&&(n=n(t)),this.options.rowLimit||n},getHighlightClassName:function(t){"use strict";if(t=new Date(t),this.options.highlight.length>0)for(var e in this.options.highlight)if(this.dateIsEqual(this.options.highlight[e],t))return this.isNow(this.options.highlight[e])?" highlight-now":" highlight";return""},isNow:function(t){"use strict";return this.dateIsEqual(t,new Date)},dateIsEqual:function(t,e){"use strict";switch(t instanceof Date||(t=new Date(t)),e instanceof Date||(e=new Date(e)),this.options.subDomain){case"x_min":case"min":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()&&t.getHours()===e.getHours()&&t.getMinutes()===e.getMinutes();case"x_hour":case"hour":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()&&t.getHours()===e.getHours();case"x_day":case"day":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();case"x_week":case"week":return t.getFullYear()===e.getFullYear()&&this.getWeekNumber(t)===this.getWeekNumber(e);case"x_month":case"month":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth();default:return!1}},dateIsLessThan:function(t,e){"use strict";function n(t,e){switch(e){case"x_min":case"min":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()).getTime();case"x_hour":case"hour":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime();case"x_day":case"day":return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();case"x_week":case"week":case"x_month":case"month":return new Date(t.getFullYear(),t.getMonth()).getTime();default:return t.getTime()}}return t instanceof Date||(t=new Date(t)),e instanceof Date||(e=new Date(e)),n(t,this.options.subDomain)<n(e,this.options.subDomain)},getDayOfYear:t.timeFormat("%j"),getWeekNumber:function(e){"use strict";return t.timeFormat(!0===this.options.weekStartOnMonday?"%W":"%U")(e)},getMonthWeekNumber:function(t){"use strict";"number"==typeof t&&(t=new Date(t));var e=this.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));return this.getWeekNumber(t)-e-1},getWeekNumberInYear:function(t){"use strict";"number"==typeof t&&(t=new Date(t))},getDayCountInMonth:function(t){"use strict";return this.getEndOfMonth(t).getDate()},getDayCountInYear:function(t){"use strict";return"number"==typeof t&&(t=new Date(t)),1===new Date(t.getFullYear(),1,29).getMonth()?366:365},getWeekDay:function(t){"use strict";return!1===this.options.weekStartOnMonday?t.getDay():0===t.getDay()?6:t.getDay()-1},getEndOfMonth:function(t){"use strict";return"number"==typeof t&&(t=new Date(t)),new Date(t.getFullYear(),t.getMonth()+1,0)},jumpDate:function(t,e,n){"use strict";var i=new Date(t);switch(n){case"hour":i.setHours(i.getHours()+e);break;case"day":i.setHours(i.getHours()+24*e);break;case"week":i.setHours(i.getHours()+24*e*7);break;case"month":i.setMonth(i.getMonth()+e);break;case"year":i.setFullYear(i.getFullYear()+e)}return new Date(i)},getMinuteDomain:function(e,n){"use strict";var i,o=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());return i=n instanceof Date?new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()):new Date(+o+1e3*n*60),t.timeMinutes(Math.min(o,i),Math.max(o,i))},getHourDomain:function(e,n){"use strict";var i=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()),o=null;n instanceof Date?o=new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours()):(o=new Date(i)).setHours(o.getHours()+n);var a=t.timeHours(Math.min(i,o),Math.max(i,o)),r=0,s=a.length;for(r=0;r<s;r++)if(r>0&&a[r].getHours()===a[r-1].getHours()){this.DSTDomain.push(a[r].getTime()),a.splice(r,1);break}return"number"==typeof n&&a.length>Math.abs(n)&&a.splice(a.length-1,1),a},getDayDomain:function(e,n){"use strict";var i=new Date(e.getFullYear(),e.getMonth(),e.getDate()),o=null;return o=n instanceof Date?new Date(n.getFullYear(),n.getMonth(),n.getDate()):new Date((o=new Date(i)).setDate(o.getDate()+parseInt(n,10))),t.timeDays(Math.min(i,o),Math.max(i,o))},getWeekDomain:function(e,n){"use strict";var i;!1===this.options.weekStartOnMonday?i=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()):1===e.getDay()?i=new Date(e.getFullYear(),e.getMonth(),e.getDate()):0===e.getDay()?(i=new Date(e.getFullYear(),e.getMonth(),e.getDate())).setDate(i.getDate()-6):i=new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()+1);var o=new Date(i),a=n;return"object"!=typeof n&&(a=new Date(o.setDate(o.getDate()+7*n))),!0===this.options.weekStartOnMonday?t.timeMondays(Math.min(i,a),Math.max(i,a)):t.timeSundays(Math.min(i,a),Math.max(i,a))},getMonthDomain:function(e,n){"use strict";var i=new Date(e.getFullYear(),e.getMonth()),o=null;return o=n instanceof Date?new Date(n.getFullYear(),n.getMonth()):(o=new Date(i)).setMonth(o.getMonth()+n),t.timeMonths(Math.min(i,o),Math.max(i,o))},getYearDomain:function(e,n){"use strict";var i,o=new Date(e.getFullYear(),0);return i=new Date(n instanceof Date?n.getFullYear():e.getFullYear()+n,0),t.timeYears(Math.min(o,i),Math.max(o,i))},getDomain:function(t,e){"use strict";switch("number"==typeof t&&(t=new Date(t)),arguments.length<2&&(e=this.options.range),this.options.domain){case"hour":var n=this.getHourDomain(t,e);return"number"==typeof e&&n.length<e&&(e>0?n.push(this.getHourDomain(n[n.length-1],2)[1]):n.shift(this.getHourDomain(n[0],-2)[0])),n;case"day":return this.getDayDomain(t,e);case"week":return this.getWeekDomain(t,e);case"month":return this.getMonthDomain(t,e);case"year":return this.getYearDomain(t,e)}},getSubDomain:function(t){"use strict";"number"==typeof t&&(t=new Date(t));var e=this;switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(t,function(t,e){switch(e){case"hour":return 60;case"day":return 1440;case"week":return 10080}}(0,this.options.domain));case"x_hour":case"hour":return this.getHourDomain(t,function(t,n){switch(n){case"day":return 24;case"week":return 168;case"month":return 24*e.getDayCountInMonth(t)}}(t,this.options.domain));case"x_day":case"day":return this.getDayDomain(t,function(t,n){switch(n){case"year":return e.getDayCountInYear(t);case"month":return e.getDayCountInMonth(t);case"week":return 7}}(t,this.options.domain));case"x_week":case"week":return this.getWeekDomain(t,function(t,n){if("month"===n){var i=new Date(t.getFullYear(),t.getMonth()+1,0),o=e.getWeekNumber(i),a=e.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));return a>o&&(a=0,o++),o-a+1}if("year"===n)return e.getWeekNumber(new Date(t.getFullYear(),11,31))}(t,this.options.domain));case"x_month":case"month":return this.getMonthDomain(t,12)}},getNextDomain:function(t){"use strict";return 0===arguments.length&&(t=1),this.getDomain(this.jumpDate(this.getDomainKeys().pop(),t,this.options.domain),1)[0]},getPreviousDomain:function(t){"use strict";return 0===arguments.length&&(t=1),this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-t,this.options.domain),1)[0]},getDatas:function(e,n,i,o,a,r){"use strict";var s=this;arguments.length<5&&(a=!0),arguments.length<6&&(r=this.APPEND_ON_UPDATE);var l=function(t,e){!1!==a?"function"==typeof a?e=a(e):"function"==typeof s.options.afterLoadData?e=s.options.afterLoadData(e):console.log("Provided callback for afterLoadData is not a function."):"csv"!==s.options.dataType&&"tsv"!==s.options.dataType||(e=this.interpretCSV(e)),s.parseDatas(e,r,n,i),"function"==typeof o&&o()};switch(typeof e){case"string":if(""===e)return l(null,{}),!0;var u=this.parseURI(e,n,i);null!==s.options.dataPostPayload&&this.parseURI(s.options.dataPostPayload,n,i);var c=null;switch(this.options.dataType){case"json":c=t.json(u);break;case"csv":c=t.csv(u);break;case"tsv":c=t.tsv(u);break;case"txt":c=t.text(u,"text/plain")}if(null!==s.options.dataRequestHeaders)for(var m in s.options.dataRequestHeaders)s.options.dataRequestHeaders.hasOwnProperty(m)&&c.header(m,s.options.dataRequestHeaders[m]);return c.then(t=>{l(null,t)}),!1;case"object":if(e===Object(e))return l(null,e),!1;default:return l(null,{}),!0}},parseDatas:function(t,e,n,i){"use strict";e===this.RESET_ALL_ON_UPDATE&&this._domains.each((function(t){t.forEach((function(t,e,n){n[e].v=null}))}));var o={},a=function(t){return t.t};for(var r in t){var s=new Date(1e3*r),l=this.getDomain(s)[0].getTime();if(this.DSTDomain.indexOf(l)>=0&&this._domains.has(l-36e5)&&(l-=36e5),!isNaN(r)&&t.hasOwnProperty(r)&&this._domains.has(l)&&l>=+n&&l<+i){var u=this._domains.get(l);o.hasOwnProperty(l)||(o[l]=u.map(a));var c=o[l].indexOf(this._domainType[this.options.subDomain].extractUnit(s));e===this.RESET_SINGLE_ON_UPDATE||isNaN(u[c].v)?u[c].v=t[r]:u[c].v+=t[r]}}},parseURI:function(t,e,n){"use strict";return(t=(t=(t=t.replace(/\{\{t:start\}\}/g,e.getTime()/1e3)).replace(/\{\{t:end\}\}/g,n.getTime()/1e3)).replace(/\{\{d:start\}\}/g,e.toISOString())).replace(/\{\{d:end\}\}/g,n.toISOString())},interpretCSV:function(t){"use strict";var e,n,i={},o=Object.keys(t[0]);for(e=0,n=t.length;e<n;e++)i[t[e][o[0]]]=+t[e][o[1]];return i},resize:function(){"use strict";var t=this.options,e=t.displayLegend?this.Legend.getDim("width")+t.legendMargin[1]+t.legendMargin[3]:0,n=t.displayLegend?this.Legend.getDim("height")+t.legendMargin[0]+t.legendMargin[2]:0,i=this.graphDim.width-t.domainGutter-t.cellPadding,o=this.graphDim.height-t.domainGutter-t.cellPadding;this.root.transition().duration(t.animationDuration).attr("width",(function(){return"middle"===t.legendVerticalPosition||"center"===t.legendVerticalPosition?i+e:Math.max(i,e)})).attr("height",(function(){return"middle"===t.legendVerticalPosition||"center"===t.legendVerticalPosition?Math.max(o,n):o+n})),this.root.select(".graph").transition().duration(t.animationDuration).attr("y",(function(){return"top"===t.legendVerticalPosition?n:0})).attr("x",(function(){return"middle"!==t.legendVerticalPosition&&"center"!==t.legendVerticalPosition||"left"!==t.legendHorizontalPosition?0:e}))},next:function(t){"use strict";return 0===arguments.length&&(t=1),this.loadNextDomain(t)},previous:function(t){"use strict";return 0===arguments.length&&(t=1),this.loadPreviousDomain(t)},jumpTo:function(t,e){"use strict";arguments.length<2&&(e=!1);var n=this.getDomainKeys(),i=n[0],o=n[n.length-1];return t<i?this.loadPreviousDomain(this.getDomain(i,t).length):e?this.loadNextDomain(this.getDomain(i,t).length):t>o&&this.loadNextDomain(this.getDomain(o,t).length)},rewind:function(){"use strict";this.jumpTo(this.options.start,!0)},update:function(t,e,n){"use strict";0===arguments.length&&(t=this.options.data),arguments.length<2&&(e=!0),arguments.length<3&&(n=this.RESET_ALL_ON_UPDATE);var i=this.getDomainKeys(),o=this;this.getDatas(t,new Date(i[0]),this.getSubDomain(i[i.length-1]).pop(),(function(){o.fill(),o.afterUpdate()}),e,n)},setLegend:function(){"use strict";var t=this.options.legend.slice(0);arguments.length>=1&&Array.isArray(arguments[0])&&(this.options.legend=arguments[0]),arguments.length>=2&&(this.options.legendColors=Array.isArray(arguments[1])&&arguments[1].length>=2?[arguments[1][0],arguments[1][1]]:arguments[1]),(arguments.length>0&&!o(t,this.options.legend)||arguments.length>=2)&&(this.Legend.buildColors(),this.fill()),this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},removeLegend:function(){"use strict";return!!this.options.displayLegend&&(this.options.displayLegend=!1,this.Legend.remove(),!0)},showLegend:function(){"use strict";return!this.options.displayLegend&&(this.options.displayLegend=!0,this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding),!0)},highlight:function(t){"use strict";return(this.options.highlight=this.expandDateSetting(t)).length>0&&(this.fill(),!0)},destroy:function(t){"use strict";return this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each((function(){"function"==typeof t?t():void 0!==t&&console.log("Provided callback for destroy() is not a function.")})),null},getSVG:function(){"use strict";for(var t={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}},e=1,n=this.options.legend.length+1;e<=n;e++)t[".q"+e]={};var i=this.root,o=["stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering","text-transform","font-family","font","font-size","font-weight"],a=function(e,n,i){-1!==o.indexOf(n)&&(t[e][n]=i)};for(var r in t)if(t.hasOwnProperty(r)){var s=i.select(r).node();if(null!==s)if("getComputedStyle"in window){var l=getComputedStyle(s,null);if(0!==l.length)for(var u=0;u<l.length;u++)a(r,l.item(u),l.getPropertyValue(l.item(u)));else for(var c in l)l.hasOwnProperty(c)&&a(r,c,l[c])}else if("currentStyle"in s){var m=s.currentStyle;for(var h in m)a(r,h,m[h])}}var g='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css"><![CDATA[ ';for(var d in t){for(var p in g+=d+" {\n",t[d])g+="\t"+p+":"+t[d][p]+";\n";g+="}\n"}return g+="]]></style>",(g+=(new XMLSerializer).serializeToString(this.root[0][0]))+"</svg>"}};var n=function(){"use strict";this.positions=t.map()};n.prototype.getPosition=function(t){"use strict";return this.positions.get(t)},n.prototype.getPositionFromIndex=function(t){"use strict";var e=this.getKeys();return this.positions.get(e[t])},n.prototype.getLast=function(){"use strict";var t=this.getKeys();return this.positions.get(t[t.length-1])},n.prototype.setPosition=function(t,e){"use strict";this.positions.set(t,e)},n.prototype.shiftRightBy=function(t){"use strict";this.positions.each((function(e,n){this.set(n,e-t)}));var e=this.getKeys();this.positions.remove(e[0])},n.prototype.shiftLeftBy=function(t){"use strict";this.positions.forEach((function(e,n){this.set(e,n+t)}));var e=this.getKeys();this.positions.remove(e[e.length-1])},n.prototype.getKeys=function(){"use strict";return this.positions.keys().sort((function(t,e){return parseInt(t,10)-parseInt(e,10)}))};var i=function(t){"use strict";this.calendar=t,this.computeDim(),null!==t.options.legendColors&&this.buildColors()};function o(t,e){"use strict";if(!e||!t)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]instanceof Array&&e[n]instanceof Array){if(!o(t[n],e[n]))return!1}else if(t[n]!==e[n])return!1;return!0}i.prototype.computeDim=function(){"use strict";var t=this.calendar.options;this.dim={width:t.legendCellSize*(t.legend.length+1)+t.legendCellPadding*t.legend.length,height:t.legendCellSize}},i.prototype.remove=function(){"use strict";this.calendar.root.select(".graph-legend").remove(),this.calendar.resize()},i.prototype.redraw=function(t){"use strict";if(!this.calendar.options.displayLegend)return!1;var e,n=this,i=this.calendar,o=i.root,a=i.options;this.computeDim();var r=a.legend.slice(0);r.push(r[r.length-1]+1);var s=i.root.select(".graph-legend");function l(t){t.attr("width",a.legendCellSize).attr("height",a.legendCellSize).attr("x",(function(t,e){return e*(a.legendCellSize+a.legendCellPadding)}))}function u(){switch(a.legendHorizontalPosition){case"right":return"center"===a.legendVerticalPosition||"middle"===a.legendVerticalPosition?t+a.legendMargin[3]:t-n.getDim("width")-a.legendMargin[1];case"middle":case"center":return Math.round(t/2-n.getDim("width")/2);default:return a.legendMargin[3]}}function c(){return"bottom"===a.legendVerticalPosition?i.graphDim.height+a.legendMargin[0]-a.domainGutter-a.cellPadding:a.legendMargin[0]}s.empty()?((o="top"===a.legendVerticalPosition?o.insert("svg",".graph"):o.append("svg")).attr("x",u()).attr("y",c()),e=o.attr("class","graph-legend").attr("height",n.getDim("height")).attr("width",n.getDim("width")).append("g").selectAll().data(r)):e=(o=s).select("g").selectAll("rect").data(r),e.enter().append("rect").call(l).attr("class",(function(t){return i.Legend.getClass(t,null===i.legendScale)})).attr("fill-opacity",0).call((function(t){null!==i.legendScale&&null!==a.legendColors&&a.legendColors.hasOwnProperty("base")&&t.attr("fill",a.legendColors.base)})).append("title"),e.exit().transition().duration(a.animationDuration).attr("fill-opacity",0).remove(),e.transition().delay((function(t,e){return a.animationDuration*e/10})).call(l).attr("fill-opacity",1).call((function(t){t.attr("fill",(function(t,e){return null===i.legendScale?"":i.legendScale(0===e?t-1:a.legend[e-1])})),t.attr("class",(function(t){return i.Legend.getClass(t,null===i.legendScale)}))})),e.select("title").text((function(t,e){return 0===e?i.formatStringWithObject(a.legendTitleFormat.lower,{min:a.legend[e],name:a.itemName[1]}):e===r.length-1?i.formatStringWithObject(a.legendTitleFormat.upper,{max:a.legend[e-1],name:a.itemName[1]}):i.formatStringWithObject(a.legendTitleFormat.inner,{down:a.legend[e-1],up:a.legend[e],name:a.itemName[1]})})),o.transition().duration(a.animationDuration).attr("x",u()).attr("y",c()).attr("width",n.getDim("width")).attr("height",n.getDim("height")),o.select("g").transition().duration(a.animationDuration).attr("transform",(function(){return"vertical"===a.legendOrientation?"rotate(90 "+a.legendCellSize/2+" "+a.legendCellSize/2+")":""})),i.resize()},i.prototype.getDim=function(t){"use strict";var e="horizontal"===this.calendar.options.legendOrientation;switch(t){case"width":return this.dim[e?"width":"height"];case"height":return this.dim[e?"height":"width"]}},i.prototype.buildColors=function(){"use strict";var e=this.calendar.options;if(null===e.legendColors)return this.calendar.legendScale=null,!1;var n=[];if(Array.isArray(e.legendColors))n=e.legendColors;else{if(!e.legendColors.hasOwnProperty("min")||!e.legendColors.hasOwnProperty("max"))return e.legendColors=null,!1;n=[e.legendColors.min,e.legendColors.max]}var i=e.legend.slice(0);i[0]>0?i.unshift(0):i[0]<=0&&i.unshift(i[0]-(i[i.length-1]-i[0])/i.length);var o=t.scaleLinear().range(n).interpolate(t.interpolateHcl).domain([t.min(i),t.max(i)]),a=i.map((function(t){return o(t)}));return this.calendar.legendScale=t.scaleThreshold().domain(e.legend).range(a),!0},i.prototype.getClass=function(t,e){"use strict";if(null===t||isNaN(t))return"";for(var n=[this.calendar.options.legend.length+1],i=0,o=this.calendar.options.legend.length-1;i<=o;i++){if(this.calendar.options.legend[0]>0&&t<0){n=["1","i"];break}if(t<=this.calendar.options.legend[i]){n=[i+1];break}}return 0===t&&n.push(0),n.unshift(""),(n.join(" r")+(e?n.join(" q"):"")).trim()},"function"==typeof define&&define.amd?define(["d3"],(function(){"use strict";return e})):"object"==typeof module&&module.exports?module.exports=e:window.CalHeatMap=e}
